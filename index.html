<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa Sensorial - Entrega 1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Quicksand:wght@500;700&display=swap');
        body, html { margin: 0; padding: 0; overflow: hidden; background: #FFF0F5; font-family: 'Quicksand', sans-serif; }
        
        #btn-regresar {
            position: absolute; top: 20px; left: 20px; padding: 12px 25px;
            background: #FF69B4; color: white; border: 3px solid white;
            border-radius: 50px; font-family: 'Bubblegum Sans', cursive;
            font-size: 1.1rem; cursor: pointer; z-index: 1000; display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <button id="btn-regresar" onclick="irAlMenu()">← REGRESAR A LA CASA</button>

    <script>
        let estado = 0; // 0:Fachada, 1:Interior, 2:Poder, 3:Emoción, 4:Refugio
        let cartas = [], rastroPoder = [];
        let sfxAbrir, sfxMenu, sfxPoder, sfxEmocion, sfxRefugio;

        function preload() {
            // Cargamos solo sonidos (estos sí están en tu proyecto)
            sfxAbrir = loadSound('magic-wand-6214.mp3');
            sfxMenu = loadSound('fairy-magic-wand-sfx-325841.mp3');
            sfxPoder = loadSound('universfield-magical-twinkle-242245.mp3');
            sfxEmocion = loadSound('magic-03-278824.mp3');
            sfxRefugio = loadSound('jump-and-spark-6136.mp3');
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            // Generar posiciones para las cartas de "Emoción" [cite: 38-45]
            for(let i=0; i<8; i++) {
                cartas.push({
                    x: random(width*0.2, width*0.8),
                    y: random(height*0.2, height*0.8),
                    rot: random(-0.3, 0.3),
                    tipo: i % 2 == 0 ? "Carta A mi yo de 10" : "De mi yo de 10"
                });
            }
        }

        function draw() {
            background(255, 240, 245);
            if (estado === 0) dibFachada();
            else if (estado === 1) dibInterior();
            else if (estado === 2) pagPoder();
            else if (estado === 3) pagEmocion();
            else if (estado === 4) pagRefugio();
        }

        // --- ESTADO 0: FACHADA CON MOÑO [cite: 31] ---
        function dibFachada() {
            rectMode(CENTER);
            fill(255); stroke(255, 105, 180); strokeWeight(5);
            rect(width/2, height/2 + 50, 450, 350, 10);
            fill(255, 182, 193);
            triangle(width/2 - 250, height/2 - 125, width/2 + 250, height/2 - 125, width/2, height/2 - 280);
            
            // Moño central
            fill(208, 32, 144); noStroke();
            triangle(width/2, height/2, width/2 - 90, height/2 - 60, width/2 - 90, height/2 + 60);
            triangle(width/2, height/2, width/2 + 90, height/2 - 60, width/2 + 90, height/2 + 60);
            ellipse(width/2, height/2, 50, 50);

            // Botón ábreme
            fill(139, 69, 19); rect(width/2, height/2 + 30, 120, 45, 15);
            fill(255); textAlign(CENTER, CENTER); textSize(20); text("abreme", width/2, height/2 + 30);
        }

        // --- ESTADO 1: INTERIOR 3 ZONAS [cite: 32-34] ---
        function dibInterior() {
            let w = width * 0.8, h = height * 0.7;
            fill(255, 255, 255, 220); stroke(255, 105, 180);
            rect(width/2, height/2, w, h, 20);
            line(width/2 - w/6, height/2 - h/2, width/2 - w/6, height/2 + h/2);
            line(width/2 + w/6, height/2 - h/2, width/2 + w/6, height/2 + h/2);
            
            textAlign(CENTER); fill(208, 32, 144); textSize(26);
            text("PODER", width/2 - w/3, height/2 - h/3);
            text("EMOCIÓN", width/2, height/2 - h/3);
            text("REFUGIO", width/2 + w/3, height/2 - h/3);
            
            drawIcon(width/2 - w/3, height/2, "✨");
            drawIcon(width/2, height/2, "✉️");
            drawIcon(width/2 + w/3, height/2, "☕");
        }

        function drawIcon(x, y, e) {
            fill(255, 192, 203, 100); noStroke();
            ellipse(x, y, 100, 100); textSize(40); text(e, x, y);
        }

        // --- ESTADO 2: PODER (Texturas) [cite: 52-53] ---
        function pagPoder() {
            background(220, 240, 220);
            fill(0, 150); textAlign(CENTER); text("Frota para revelar tu poder", width/2, 50);
            for(let p of rastroPoder) { fill(p.c); noStroke(); ellipse(p.x, p.y, p.s); }
            if(mouseIsPressed) {
                rastroPoder.push({ x: mouseX, y: mouseY, s: random(20, 60), c: color(random(150,255), 255, random(150,255), 100) });
                if (!sfxPoder.isPlaying()) sfxPoder.play();
            }
        }

        // --- ESTADO 3: EMOCIÓN (Cartas) [cite: 38-45] ---
        function pagEmocion() {
            background(255); fill(208, 32, 144); text("Cartas a mi yo de 10 años", width/2, 60);
            for(let c of cartas) {
                push(); translate(c.x, c.y); rotate(c.rot);
                fill(255); stroke(255, 182, 193); rect(0, 0, 140, 100, 5);
                fill(100); textSize(11); text(c.tipo, 70, 50); pop();
            }
        }

        // --- ESTADO 4: REFUGIO (Indian Tea) [cite: 46-51] ---
        function pagRefugio() {
            background(250, 240, 230);
            fill(255, 192, 203); stroke(208, 32, 144);
            rect(width/2, height/2 - 20, 180, 220, 10);
            fill(255); noStroke(); text("INDIAN\nTEA", width/2, height/2 - 20);
            fill(208, 32, 144); text("Arma tu fiesta del té", width/2, height - 60);
        }

        function mousePressed() {
            if (estado === 0 && dist(mouseX, mouseY, width/2, height/2 + 30) < 60) {
                sfxAbrir.play(); estado = 1;
            } else if (estado === 1) {
                sfxMenu.play();
                if (mouseX < width * 0.4) estado = 2;
                else if (mouseX < width * 0.6) { estado = 3; sfxEmocion.play(); }
                else { estado = 4; sfxRefugio.play(); }
                document.getElementById('btn-regresar').style.display = 'block';
            }
        }

        function irAlMenu() {
            estado = 1; sfxMenu.play();
            document.getElementById('btn-regresar').style.display = 'none';
        }

        function windowResized() { resizeCanvas(windowWidth, windowHeight); }
    </script>
</body>
</html>