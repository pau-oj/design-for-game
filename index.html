<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa Sensorial - Casa de Muñecas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Quicksand:wght@500;700&display=swap');
        
        body, html { margin: 0; padding: 0; overflow: hidden; background: #FFF0F5; font-family: 'Quicksand', sans-serif; }
        
        /* Botón de navegación */
        #btn-regresar {
            position: absolute; top: 20px; left: 20px; padding: 12px 25px;
            background: #FF69B4; color: white; border: 3px solid white;
            border-radius: 50px; font-family: 'Bubblegum Sans', cursive;
            font-size: 1.1rem; cursor: pointer; z-index: 1000; display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        #btn-regresar:hover { background: #D02090; }
    </style>
</head>
<body>

    <button id="btn-regresar" onclick="irAlMenu()">← REGRESAR A LA CASA</button>

    <script>
        let estado = 0; // 0:Fachada, 1:Interior, 2:Emoción, 3:Refugio, 4:Poder
        let cartas = [];
        let rastroPoder = [];

        function setup() {
            createCanvas(windowWidth, windowHeight);
            // Generar posiciones para las cartas de "Emoción" [cite: 38-45]
            for(let i=0; i<8; i++) {
                cartas.push({
                    x: random(width*0.2, width*0.8),
                    y: random(height*0.2, height*0.8),
                    rot: random(-0.3, 0.3),
                    tipo: i % 2 == 0 ? "A mi yo de 10" : "De mi yo de 10"
                });
            }
        }

        function draw() {
            background(255, 240, 245);
            
            if (estado === 0) {
                dibujarFachada();
            } else if (estado === 1) {
                dibujarInterior();
            } else if (estado === 2) {
                pagEmocion();
            } else if (estado === 3) {
                pagRefugio();
            } else if (estado === 4) {
                pagPoder();
            }
        }

        // --- ESTADO 0: FACHADA (Basado en Boceto pág 1) ---
        function dibujarFachada() {
            rectMode(CENTER);
            // Casa
            fill(255); stroke(255, 105, 180); strokeWeight(5);
            rect(width/2, height/2 + 50, 450, 350, 10);
            // Techo
            fill(255, 182, 193);
            triangle(width/2 - 250, height/2 - 125, width/2 + 250, height/2 - 125, width/2, height/2 - 280);
            
            // El gran moño central [cite: 31]
            fill(208, 32, 144); noStroke();
            triangle(width/2, height/2, width/2 - 90, height/2 - 60, width/2 - 90, height/2 + 60);
            triangle(width/2, height/2, width/2 + 90, height/2 - 60, width/2 + 90, height/2 + 60);
            ellipse(width/2, height/2, 50, 50);

            // Botón ábreme
            fill(139, 69, 19); rect(width/2, height/2 + 30, 120, 45, 15);
            fill(255); textAlign(CENTER, CENTER); textSize(20); text("abreme", width/2, height/2 + 30);
        }

        // --- ESTADO 1: INTERIOR (Basado en Boceto pág 2) ---
        function dibujarInterior() {
            let w = width * 0.8; let h = height * 0.7;
            fill(255, 255, 255, 220); stroke(255, 105, 180); strokeWeight(3);
            rect(width/2, height/2, w, h, 20);
            
            // Divisiones de habitaciones
            line(width/2 - w/6, height/2 - h/2, width/2 - w/6, height/2 + h/2);
            line(width/2 + w/6, height/2 - h/2, width/2 + w/6, height/2 + h/2);

            // Títulos de zonas [cite: 32, 33, 34]
            textAlign(CENTER); fill(208, 32, 144); textSize(26);
            text("PODER", width/2 - w/3, height/2 - h/3);
            text("EMOCIÓN", width/2, height/2 - h/3);
            text("REFUGIO", width/2 + w/3, height/2 - h/3);
            
            // Iconos decorativos simples
            dibujarIcono(width/2 - w/3, height/2, "✨");
            dibujarIcono(width/2, height/2, "✉️");
            dibujarIcono(width/2 + w/3, height/2, "☕");
        }

        function dibujarIcono(x, y, emoji) {
            fill(255, 192, 203, 100); noStroke();
            ellipse(x, y, 100, 100);
            textSize(40); text(emoji, x, y);
        }

        // --- ESTADO 2: EMOCIÓN (Cartas - Boceto pág 3) ---
        function dibujarEmocion() {
            background(255);
            fill(208, 32, 144); textAlign(CENTER); textSize(22);
            text("Cartas de/a mi yo de 10 años", width/2, 60);
            
            for(let c of cartas) {
                push(); translate(c.x, c.y); rotate(c.rot);
                fill(255); stroke(255, 182, 193); strokeWeight(2);
                rect(0, 0, 140, 100, 5);
                fill(100); textSize(11); text(c.tipo, 70, 50);
                pop();
            }
        }

        // --- ESTADO 3: REFUGIO (Tea Party - Boceto pág 4) ---
        function dibujarRefugio() {
            background(250, 240, 230);
            // Lata de Té "Indian Tea" [cite: 46]
            fill(255, 192, 203); stroke(208, 32, 144);
            rect(width/2, height/2 - 20, 180, 220, 10);
            fill(255); noStroke(); textAlign(CENTER); textSize(20);
            text("INDIAN\nTEA", width/2, height/2 - 20);
            
            // Tazas y platos abstractos
            fill(255); stroke(208, 32, 144);
            ellipse(width/2 - 200, height/2 + 100, 100, 60); // Plato
            rect(width/2 - 200, height/2 + 80, 60, 40, 5);  // Taza
            
            ellipse(width/2 + 200, height/2 + 100, 100, 60);
            rect(width/2 + 200, height/2 + 80, 60, 40, 5);
            
            fill(208, 32, 144); noStroke();
            text("Arma tu fiesta del té", width/2, height - 60);
        }

        // --- ESTADO 4: PODER (Texturas - Boceto pág 5) ---
        function dibujarPoder() {
            background(220, 240, 220); // Tono verde del boceto
            fill(0, 150); textAlign(CENTER); 
            text("Frota para revelar tu poder (el escudo de princesa)", width/2, 50);
            
            // Dibujar el rastro sensorial [cite: 52, 53]
            for(let p of rastroPoder) {
                fill(p.c); noStroke();
                ellipse(p.x, p.y, p.s);
            }
            if(mouseIsPressed) {
                rastroPoder.push({
                    x: mouseX, y: mouseY, 
                    s: random(20, 60), 
                    c: color(random(150,255), 255, random(150,255), 100)
                });
            }
        }

        // --- INTERACCIONES ---
        function mousePressed() {
            if (estado === 0) {
                // Clic en botón "abreme"
                if (dist(mouseX, mouseY, width/2, height/2 + 30) < 60) {
                    estado = 1;
                }
            } else if (estado === 1) {
                // Selección de habitación
                if (mouseX < width * 0.4) { estado = 4; }
                else if (mouseX < width * 0.6) { estado = 2; }
                else { estado = 3; }
                document.getElementById('btn-regresar').style.display = 'block';
            }
        }

        function irAlMenu() {
            estado = 1;
            document.getElementById('btn-regresar').style.display = 'none';
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>