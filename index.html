<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Mapa Que No Se Ve - Entrega Maestría</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Quicksand:wght@500;700&display=swap');

        :root {
            --rosa-vivo: #D02090;
            --rosa-claro: #FFF0F5;
            --rosa-borde: #FF69B4;
        }

        body, html {
            margin: 0; padding: 0; overflow: hidden;
            background-color: var(--rosa-claro);
            font-family: 'Quicksand', sans-serif;
        }

        /* Botón Regresar estilo Sticker */
        #btn-regresar {
            position: absolute;
            top: 20px; left: 20px;
            padding: 10px 25px;
            background-color: var(--rosa-borde);
            color: white;
            border: 3px solid white;
            border-radius: 50px;
            font-family: 'Bubblegum Sans', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* Tarjetas de texto del Brief flotantes */
        .card-brief {
            position: absolute;
            background: white;
            border: 2px dashed var(--rosa-borde);
            border-radius: 15px;
            padding: 12px;
            width: 180px;
            font-size: 0.8rem;
            color: var(--rosa-vivo);
            pointer-events: none;
            display: none;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.05);
        }

        #canvas-container {
            width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
        }
    </style>
</head>
<body>

    <button id="btn-regresar" onclick="irAlMenu()">← REGRESAR A LA CASA</button>

    <div id="info-emocion" class="card-brief" style="top: 15%; right: 5%;">
        <b>EMOCIÓN:</b> Curiosidad expansiva, destellos y colores vivos como el rosa[cite: 33].
    </div>
    <div id="info-refugio" class="card-brief" style="bottom: 15%; right: 5%;">
        <b>REFUGIO:</b> Un mundo de imaginación jugando con muñecas y pinturas[cite: 34].
    </div>
    <div id="info-poder" class="card-brief" style="top: 20%; left: 5%;">
        <b>PODER:</b> El sentimiento de ser princesa como un escudo de confianza[cite: 32].
    </div>

    <div id="canvas-container"></div>

    <script>
        let estado = 0; // 0: Fachada, 1: Interior, 2: Emoción, 3: Refugio, 4: Poder
        let imgFachada, imgInterior, imgTe, imgFotoNina, imgTramaPoder;
        let cartas = [];

        function preload() {
            // Asegúrate de que los nombres de archivo sean exactos
            imgFachada = loadImage('casa_con_mono.png'); // Boceto con moño 
            imgInterior = loadImage('casa_abierta.png'); // Boceto interior 
            imgTe = loadImage('indian_tea.png'); // Imagen de la lata de té [cite: 46]
            imgFotoNina = loadImage('foto_ninez.jpg'); // Tu foto de niña
            imgTramaPoder = loadImage('trama_poder.png'); // Dibujo de texturas 
        }

        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('canvas-container');
            
            // Generar cartas de "Emoción" [cite: 38, 39]
            for(let i=0; i<6; i++) {
                cartas.push({
                    x: random(width*0.2, width*0.8),
                    y: random(height*0.2, height*0.8),
                    txt: i%2==0 ? "Carta A mi yo de 10" : "Carta DE mi yo de 10",
                    rot: random(-0.2, 0.2)
                });
            }
        }

        function draw() {
            background(255, 240, 245);
            imageMode(CENTER);

            if (estado === 0) {
                // FACHADA 
                image(imgFachada, width/2, height/2, 600, 450);
                drawBotonAbreme();
            } else if (estado === 1) {
                // INTERIOR (MENÚ) 
                image(imgInterior, width/2, height/2, width*0.8, height*0.8);
            } else if (estado === 2) {
                // JUEGO: EMOCIÓN [cite: 33, 38]
                drawEmocion();
            } else if (estado === 3) {
                // JUEGO: REFUGIO [cite: 34, 48]
                drawRefugio();
            } else if (estado === 4) {
                // JUEGO: PODER [cite: 32, 53]
                drawPoder();
            }
        }

        function drawBotonAbreme() {
            fill(139, 69, 19); // Marrón moño 
            rectMode(CENTER);
            noStroke();
            rect(width/2, height/2 + 25, 120, 45, 10);
            fill(255);
            textAlign(CENTER, CENTER);
            textSize(18);
            text("ábreme", width/2, height/2 + 25);
        }

        function drawEmocion() {
            background(255);
            textAlign(CENTER);
            fill(208, 32, 144);
            textSize(24);
            text("Explora tus cartas", width/2, 50);
            
            for(let c of cartas) {
                push();
                translate(c.x, c.y);
                rotate(c.rot);
                fill(255);
                stroke(255, 105, 180);
                rect(0, 0, 140, 90, 5);
                fill(50);
                textSize(10);
                text(c.txt, 70, 45);
                pop();
            }
        }

        function drawRefugio() {
            background(250, 240, 230);
            image(imgTe, width/2, height/2, 250, 250); // Indian Tea [cite: 46]
            fill(208, 32, 144);
            textSize(22);
            text("Arma tu fiesta del té", width/2, height - 60);
        }

        function drawPoder() {
            // Mapeo sensorial de texturas [cite: 22, 53]
            image(imgFotoNina, width/2, height/2, 500, 400);
            if (!mouseIsPressed) {
                background(200, 230, 200, 240); // Capa verde boceto 
                fill(0);
                text("Revela tu poder con círculos", width/2, 50);
            }
            if (mouseIsPressed) {
                image(imgTramaPoder, mouseX, mouseY, 120, 120);
            }
        }

        function mousePressed() {
            if (estado === 0) {
                // Clic en "ábreme"
                if (dist(mouseX, mouseY, width/2, height/2 + 25) < 60) {
                    estado = 1;
                    toggleCards(true);
                }
            } else if (estado === 1) {
                // Selección de habitaciones según posición horizontal
                if (mouseX < width * 0.33) estado = 2; 
                else if (mouseX < width * 0.66) estado = 3;
                else estado = 4;
                
                if (estado > 1) {
                    toggleCards(false);
                    document.getElementById('btn-regresar').style.display = 'block';
                }
            }
        }

        function irAlMenu() {
            estado = 1;
            toggleCards(true);
            document.getElementById('btn-regresar').style.display = 'none';
        }

        function toggleCards(visible) {
            let display = visible ? 'block' : 'none';
            document.getElementById('info-emocion').style.display = display;
            document.getElementById('info-refugio').style.display = display;
            document.getElementById('info-poder').style.display = display;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>